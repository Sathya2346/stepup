<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title th:text="'StepUp.in - ' + ${product.name}"></title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Poppins:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" th:href="@{/style.css}">
    <style>
        .product-image {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
        }

        .rating-star {
            color: #ffc107;
        }
    </style>
</head>

<body>

    <div th:replace="~{fragments :: header}"></div>

    <!-- ===== BRAND ===== -->
    <div class="container brand-area text-center">
        <h1>StepUp.in</h1>
        <div class="divider"></div>

        <ul class="category">
            <li><a th:href="@{/products(category='Womens')}">Womens</a></li>
            <li><a th:href="@{/products(category='Mens')}">Mens</a></li>
            <li><a th:href="@{/products}">Products</a></li>
            <li><a th:href="@{/products(category='Brands')}">Brands</a></li>
            <li><a th:href="@{/offers}">Offers</a></li>
        </ul>

        <div class="divider"></div>
    </div>

    <div class="container mt-5 mb-5">
        <div class="row">
            <div class="col-md-6">
                <img th:src="${product.image}" class="product-image shadow-sm">
            </div>
            <div class="col-md-6">
                <h2 style="font-family: 'Playfair Display'" th:text="${product.name}">Product Name</h2>
                <div class="mb-3">
                    <span class="rating-star">
                        <i th:each="i : ${#numbers.sequence(1, 5)}"
                            th:class="${i <= product.rating} ? 'bi bi-star-fill' : 'bi bi-star'"></i>
                    </span>
                    <span class="text-muted ms-2" th:text="${#lists.size(reviews)} + ' Reviews'">0 Reviews</span>
                </div>
                <h3 class="fw-bold mb-3" th:text="'₹ ' + ${product.price}">₹ 1000</h3>
                <p th:text="${product.description}" class="lead text-muted">Description...</p>

                <div class="mb-4">
                    <label class="form-label fw-bold">Select Size</label>
                    <select class="form-select w-50" id="sizeSelector">
                        <option th:each="sizeEntry : ${product.sizes}"
                            th:if="${sizeEntry.value != null and sizeEntry.value > 0}" th:value="${sizeEntry.key}"
                            th:text="${sizeEntry.key} + ' (' + ${sizeEntry.value} + ' left)'"></option>
                    </select>
                </div>

                <div class="mb-3">
                    <span th:if="${product.totalStock > 0}" class="badge bg-success"
                        th:text="'Total In Stock: ' + ${product.totalStock}">In Stock</span>
                    <span th:if="${product.totalStock == 0}" class="badge bg-danger">Out of Stock</span>
                </div>

                <div class="d-grid gap-2 col-md-6 mt-4">
                    <button th:if="${product.totalStock > 0}" class="btn btn-dark btn-lg add-cart-btn-details"
                        th:attr="data-id=${product.id}">Add to Cart</button>
                    <button th:if="${product.totalStock == 0}" class="btn btn-secondary btn-lg" disabled>Out of
                        Stock</button>
                </div>
            </div>
        </div>

        <!-- REVIEWS SECTION -->
        <div class="mt-5 p-4 bg-light rounded">
            <h3 style="font-family: 'Playfair Display'" class="mb-4">Customer Reviews</h3>

            <div th:each="review : ${reviews}" class="card mb-3 border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <h6 class="fw-bold" th:text="${review.user.name}">User</h6>
                        <small class="text-muted" th:text="${#temporals.format(review.date, 'dd-MM-yyyy')}">Date</small>
                    </div>
                    <div class="text-warning mb-2">
                        <i th:each="i : ${#numbers.sequence(1, 5)}"
                            th:class="${i <= review.rating} ? 'bi bi-star-fill' : 'bi bi-star'"></i>
                    </div>
                    <p class="mb-0" th:text="${review.comment}">Review comment...</p>
                </div>
            </div>

            <div th:if="${reviews.empty}" class="text-center text-muted my-5">
                <p>No reviews yet. Be the first to review!</p>
            </div>

            <hr class="my-5">

            <div class="card border-0">
                <div class="card-body">
                    <h4>Write a Review</h4>
                    <form th:action="@{/product/{id}/review(id=${product.id})}" method="post">
                        <div class="mb-3">
                            <label class="form-label">Rating</label>
                            <select name="rating" class="form-select w-auto">
                                <option value="5">★★★★★ (Excellent)</option>
                                <option value="4">★★★★☆ (Good)</option>
                                <option value="3">★★★☆☆ (Average)</option>
                                <option value="2">★★☆☆☆ (Poor)</option>
                                <option value="1">★☆☆☆☆ (Terrible)</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Review</label>
                            <textarea name="comment" class="form-control" rows="3" required
                                placeholder="Share your thoughts..."></textarea>
                        </div>
                        <button type="submit" class="btn btn-outline-dark">Submit Review</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/script.js}"></script>
    <div th:replace="~{fragments :: footer}"></div>
</body>

</html>